{% extends "dashboards/base_dashboard.html" %}
{% block dashboard_content %}

<!-- ðŸ¦´ Skeleton Loading Overlay -->
<div id="dashboard-skeleton"
  class="fixed inset-0 z-[60] bg-gray-50 dark:bg-gray-900 overflow-hidden pointer-events-none transition-opacity duration-700 p-8">
  <div class="max-w-4xl mx-auto space-y-8">
    <div class="h-16 w-80 skeleton rounded-2xl"></div>
    <div class="space-y-6">
      <div class="h-64 w-full skeleton rounded-3xl"></div>
      <div class="h-64 w-full skeleton rounded-3xl"></div>
    </div>
  </div>
</div>

<script>
  window.addEventListener('load', () => {
    const skeleton = document.getElementById('dashboard-skeleton');
    if (skeleton) {
      skeleton.style.opacity = '0';
      setTimeout(() => skeleton.remove(), 700);
    }
  });
</script>

<div class="max-w-4xl mx-auto">

  <div class="mb-8 flex items-center gap-3 animate-fade-up">
    <div class="h-12 w-12 bg-blue-100 rounded-2xl flex items-center justify-center text-2xl shadow-sm text-blue-600">ðŸš›
    </div>
    <div>
      <h2 class="text-3xl font-heading font-bold text-gray-800 dark:text-white">Assigned Jobs</h2>
      <p class="text-gray-500 dark:text-gray-400">Your active pickup tasks.</p>
    </div>
  </div>

  {% if reports %}
  <div class="space-y-6">
    {% for report in reports %}
    <div
      class="glass-card rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 animate-fade-up group border border-white/40">

      <div class="flex flex-col sm:flex-row gap-6">

        <!-- Image -->
        <div class="w-full sm:w-1/3 h-48 sm:h-auto rounded-xl overflow-hidden relative shadow-md">
          {% if report.image %}
          <img src="{{ report.image.url }}"
            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
            onerror="this.src='https://plus.unsplash.com/premium_photo-1663045498422-9a95cca250ed?q=80&w=400&auto=format&fit=crop'">
          {% else %}
          <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
            <span class="text-4xl">ðŸ“¸</span>
          </div>
          {% endif %}
          <div class="absolute bottom-2 left-2">
            <span class="px-2 py-1 bg-black/50 backdrop-blur rounded text-white text-xs font-bold shadow-sm">
              {{ report.get_waste_type_display }}
            </span>
          </div>
        </div>

        <!-- Content -->
        <div class="flex-1 flex flex-col">
          <div class="flex justify-between items-start">
            <div>
              <div class="flex items-center gap-3 mb-1">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Waste Pickup #{{ report.id }}</h3>
                <a href="{% url 'report_detail' report.id %}"
                  class="text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full font-bold text-gray-400 dark:text-gray-300 hover:text-eco-600 dark:hover:text-eco-400 transition-colors uppercase tracking-widest">Detail
                  â†’</a>
              </div>
              <p class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
                ðŸ•’ Assigned: {{ report.created_at|date:"M d â€¢ h:i A" }}
              </p>
            </div>

            <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider
               {% if report.severity == 'high' %} bg-red-100 text-red-600
               {% elif report.severity == 'medium' %} bg-yellow-100 text-yellow-600
               {% else %} bg-green-100 text-green-600 {% endif %}">
              {{ report.severity }} Priority
            </span>
          </div>

          <div
            class="my-4 bg-gray-50/80 dark:bg-gray-700/50 p-3 rounded-lg border border-gray-100/50 dark:border-gray-600/50">
            <p class="text-gray-700 dark:text-gray-200 text-sm">"{{ report.description }}"</p>
          </div>

          <!-- Actions -->
          <div class="mt-auto pt-2">
            <form method="post" action="{% url 'resolve_report' report.id %}">
              {% csrf_token %}
              <button type="submit"
                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-green-500/30 hover:-translate-y-0.5 transition-all flex justify-center items-center gap-2">
                <span class="text-lg">âœ…</span> Mark as Resolved
              </button>
            </form>
          </div>
        </div>

      </div>

    </div>
    {% endfor %}
  </div>

  {% else %}
  <div
    class="text-center py-20 bg-white/50 dark:bg-gray-800/50 backdrop-blur rounded-3xl border border-dashed border-gray-300 dark:border-gray-700 animate-scale-in">
    <div class="text-6xl mb-4 grayscale opacity-30">ðŸšš</div>
    <h3 class="text-xl font-bold text-gray-600 dark:text-gray-200">No active jobs</h3>
    <p class="text-gray-400 dark:text-gray-500 mt-2">You're all clear! Relax until new tasks arrive.</p>
  </div>
  {% endif %}

</div>
{% endblock %}