{% extends "dashboards/base_dashboard.html" %}

{% block dashboard_content %}

<!-- ğŸ¦´ Skeleton Loading Overlay -->
<div id="dashboard-skeleton"
  class="fixed inset-0 z-[60] bg-gray-50 dark:bg-gray-900 overflow-hidden pointer-events-none transition-opacity duration-700 p-8">
  <div class="max-w-7xl mx-auto space-y-8">
    <div class="h-48 w-full skeleton rounded-3xl"></div>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="h-24 skeleton rounded-2xl"></div>
      <div class="h-24 skeleton rounded-2xl"></div>
      <div class="h-24 skeleton rounded-2xl"></div>
      <div class="h-24 skeleton rounded-2xl"></div>
    </div>
    <div class="flex gap-8">
      <div class="flex-1 h-96 skeleton rounded-3xl"></div>
    </div>
  </div>
</div>

<script>
  window.addEventListener('load', () => {
    const skeleton = document.getElementById('dashboard-skeleton');
    if (skeleton) {
      skeleton.style.opacity = '0';
      setTimeout(() => skeleton.remove(), 700);
    }
  });
</script>

<!-- ğŸŒˆ Admin Header -->
<div class="relative rounded-3xl p-10 text-white mb-10 overflow-hidden shadow-2xl animate-fade-up group spotlight-card">
  <!-- Dynamic Background -->
  <div
    class="absolute inset-0 bg-gradient-to-r from-gray-800 to-slate-900 transition-transform duration-1000 group-hover:scale-105">
  </div>
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30">
  </div>
  <div
    class="absolute -right-10 -bottom-10 text-9xl opacity-10 transform rotate-12 group-hover:rotate-6 transition-transform duration-700">
    âš™ï¸</div>

  <div class="relative z-10">
    <h1 class="text-4xl font-heading font-bold mb-2 text-white drop-shadow-sm flex items-center gap-3">
      Welcome, {{ user.username|default:"Admin" }}
    </h1>
    <p class="text-gray-300 text-lg font-medium opacity-90">
      System Overview â€¢ <span class="text-green-400 font-bold">â— Operational</span>
    </p>
  </div>
</div>

<!-- ğŸ“Š System Stats -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">

  <!-- Users -->
  <div
    class="glass-card spotlight-card rounded-2xl p-6 shadow-lg hover:-translate-y-1 transition-transform border-l-4 border-indigo-500 animate-fade-up delay-100">
    <div class="flex justify-between items-start">
      <div>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Total Users</p>
        <p class="text-3xl font-heading font-bold text-gray-800 dark:text-white">{{ total_users|default:"0" }}</p>
      </div>
      <div class="h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center text-xl">ğŸ‘¥</div>
    </div>
  </div>

  <!-- Reports -->
  <div
    class="glass-card spotlight-card rounded-2xl p-6 shadow-lg hover:-translate-y-1 transition-transform border-l-4 border-orange-500 animate-fade-up delay-200">
    <div class="flex justify-between items-start">
      <div>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Total Reports</p>
        <p class="text-3xl font-heading font-bold text-gray-800 dark:text-white">{{ total_reports|default:"0" }}</p>
      </div>
      <div class="h-10 w-10 bg-orange-100 rounded-full flex items-center justify-center text-xl">ğŸ“</div>
    </div>
  </div>

  <!-- Pending -->
  <div
    class="glass-card spotlight-card rounded-2xl p-6 shadow-lg hover:-translate-y-1 transition-transform border-l-4 border-yellow-400 animate-fade-up delay-300">
    <div class="flex justify-between items-start">
      <div>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Pending</p>
        <p class="text-3xl font-heading font-bold text-gray-800 dark:text-white">{{ pending_reports|default:"0" }}</p>
      </div>
      <div class="h-10 w-10 bg-yellow-100 rounded-full flex items-center justify-center text-xl">â³</div>
    </div>
  </div>

  <!-- Resolved -->
  <div
    class="glass-card spotlight-card rounded-2xl p-6 shadow-lg hover:-translate-y-1 transition-transform border-l-4 border-green-500 animate-fade-up delay-400">
    <div class="flex justify-between items-start">
      <div>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Resolved</p>
        <p class="text-3xl font-heading font-bold text-gray-800 dark:text-white">{{ resolved_reports|default:"0" }}</p>
      </div>
      <div class="h-10 w-10 bg-green-100 rounded-full flex items-center justify-center text-xl">âœ…</div>
    </div>
  </div>

</div>

<!-- ğŸ“ˆ Data Visualization -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">

  <!-- Status Chart -->
  <div class="glass-card rounded-2xl p-6 shadow-lg animate-fade-up delay-500">
    <h3 class="text-lg font-bold text-gray-700 dark:text-gray-200 mb-6 flex items-center gap-2">
      <span class="p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg">ğŸ“Š</span> Report Status
      Distribution
    </h3>
    <div class="relative h-64">
      <canvas id="adminStatusChart"></canvas>
    </div>
  </div>

  <!-- Waste Type Chart -->
  <div class="glass-card rounded-2xl p-6 shadow-lg animate-fade-up delay-500">
    <h3 class="text-lg font-bold text-gray-700 dark:text-gray-200 mb-6 flex items-center gap-2">
      <span class="p-2 bg-teal-100 dark:bg-teal-900/30 text-teal-600 rounded-lg">ğŸ—‘ï¸</span> Waste Composition
    </h3>
    <div class="relative h-64 flex justify-center">
      <canvas id="adminWasteChart"></canvas>
    </div>
  </div>

</div>

<!-- ğŸ§­ Admin Actions -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 animate-fade-up delay-600">

  <a href="{% url 'admin_all_reports' %}"
    class="glass-card spotlight-card p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group ring-1 ring-black/5 dark:ring-white/5 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900">
    <div
      class="h-12 w-12 bg-blue-100 rounded-xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
      ğŸ“</div>
    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-1">Manage Reports</h3>
    <p class="text-gray-500 dark:text-gray-400 text-sm">Assign reports to workers and track resolution.</p>
  </a>

  <a href="{% url 'worker_performance_dashboard' %}"
    class="glass-card spotlight-card p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group ring-1 ring-black/5 dark:ring-white/5 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900">
    <div
      class="h-12 w-12 bg-indigo-100 rounded-xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
      ğŸ‘·</div>
    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-1">Worker Management</h3>
    <p class="text-gray-500 dark:text-gray-400 text-sm">Monitor performance metrics and efficiency.</p>
  </a>

  <a href="{% url 'admin_support_tickets' %}"
    class="glass-card spotlight-card p-6 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group ring-1 ring-black/5 dark:ring-white/5 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900">
    <div
      class="h-12 w-12 bg-red-100 rounded-xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
      ğŸ«</div>
    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-1">Support Tickets</h3>
    <p class="text-gray-500 dark:text-gray-400 text-sm">Review issues and feedback reported by citizens.</p>
  </a>

</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Status Chart
    const pendingVal = Number("{{ pending_reports|default:'0' }}");
    const assignedVal = Number("{{ assigned_reports|default:'0' }}");
    const resolvedVal = Number("{{ resolved_reports|default:'0' }}");

    const statusCanvas = document.getElementById('adminStatusChart');
    if (statusCanvas) {
      const ctx = statusCanvas.getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Pending', 'Assigned', 'Resolved'],
          datasets: [{
            label: 'Count',
            data: [pendingVal, assignedVal, resolvedVal],
            backgroundColor: [
              createChartGradient(ctx, '#facc15', '#a16207'),
              createChartGradient(ctx, '#60a5fa', '#1d4ed8'),
              createChartGradient(ctx, '#22c55e', '#15803d')
            ],
            borderRadius: 10
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          animation: {
            duration: 2000,
            easing: 'easeOutElastic',
            delay: (context) => context.dataIndex * 150
          },
          scales: {
            y: { beginAtZero: true, grid: { color: 'rgba(156, 163, 175, 0.05)' } },
            x: { grid: { display: false } }
          }
        }
      });
    }

    // Waste Composition Chart
    const wasteLabels = JSON.parse('{{ waste_labels|safe|default:"[]" }}');
    const wasteValues = JSON.parse('{{ waste_values|safe|default:"[]" }}');

    const wasteCanvas = document.getElementById('adminWasteChart');
    if (wasteCanvas) {
      const ctx = wasteCanvas.getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: wasteLabels,
          datasets: [{
            data: wasteValues,
            backgroundColor: ['#f97316', '#22c55e', '#3b82f6', '#a855f7', '#ef4444'],
            borderWidth: 0,
            hoverOffset: 15
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '65%',
          plugins: {
            legend: { position: 'right', labels: { usePointStyle: true, font: { weight: 'bold', size: 11 } } }
          },
          animation: {
            animateRotate: true,
            animateScale: true,
            duration: 2500,
            easing: 'easeOutElastic'
          }
        }
      });
    }
  });
</script>

{% endblock %}