{% extends "dashboards/base_dashboard.html" %}

{% block dashboard_content %}
<div class="max-w-4xl mx-auto min-h-screen">
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-4xl font-heading font-bold text-gray-800 dark:text-white">Inbox</h1>
            <p class="text-gray-500 font-medium">Your mission updates and alerts.</p>
        </div>
        <button onclick="markAllRead()"
            class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl text-xs font-bold uppercase tracking-widest hover:bg-gray-50 dark:hover:bg-gray-700 transition shadow-sm">
            âœ“ Mark All Read
        </button>
    </div>

    <div class="space-y-4 animate-fade-up">
        {% for note in notifications %}
        <div
            class="glass-card p-6 rounded-2xl flex gap-5 border-l-4 transition-all hover:scale-[1.01] hover:shadow-lg group
             {% if not note.is_read %} border-l-green-500 bg-green-50/50 dark:bg-green-900/10 {% else %} border-l-gray-300 dark:border-l-gray-600 {% endif %}">

            <div
                class="h-12 w-12 rounded-xl flex-shrink-0 flex items-center justify-center text-2xl
                {% if not note.is_read %} bg-green-100 dark:bg-green-900/30 text-green-600 {% else %} bg-gray-100 dark:bg-gray-800 text-gray-400 {% endif %}">
                {% if "assigned" in note.message|lower %}ðŸšš
                {% elif "resolved" in note.message|lower %}âœ…
                {% elif "welcome" in note.message|lower %}ðŸ‘‹
                {% else %}ðŸ””{% endif %}
            </div>

            <div class="flex-1">
                <div class="flex justify-between items-start mb-1">
                    <h3 class="font-bold text-gray-900 dark:text-white {% if not note.is_read %} text-lg {% endif %}">
                        {{ note.title|default:"Notification" }}
                    </h3>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                        {% if note.created_at|timesince == "0 minutes" %}
                        Just now
                        {% else %}
                        {{ note.created_at|timesince }} ago
                        {% endif %}
                    </span>
                </div>
                <p class="text-gray-600 dark:text-gray-300 leading-relaxed">{{ note.message }}</p>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-20 opacity-50">
            <div class="text-6xl mb-4">ðŸ“­</div>
            <p class="font-bold text-xl">All caught up!</p>
            <p class="text-sm">No new notifications.</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function markAllRead() {
        fetch('/notifications/mark-read/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            }
        }).then(res => {
            if (res.ok) window.location.reload();
        });
    }
</script>
{% endblock %}